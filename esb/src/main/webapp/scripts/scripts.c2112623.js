"use strict";angular.module("openehrPocApp",["ngResource","ngTouch","ngAnimate","ui.router","ui.bootstrap","angular-loading-bar","growlNotifications","angularUtils.directives.dirPagination","ui.timepicker","ui.calendar"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("patients-list",{url:"/patients?ageRange&department&order&reverse",views:{main:{templateUrl:"views/patients/patients-list.html",controller:"PatientsListCtrl"}}}).state("header",{url:"/?role&email",views:{main:{controller:"headerController"}}}).state("patients-charts",{url:"/",views:{main:{templateUrl:"views/patients/patients-charts.html",controller:"PatientsChartsCtrl"}}}).state("patients-lookup",{url:"/lookup",views:{actions:{templateUrl:"views/home-sidebar.html"},main:{controller:"PatientsLookupCtrl"}}}).state("patients-summary",{url:"/patients/{patientId:int}/patients-summary",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/patients/patients-summary.html",controller:"PatientsSummaryCtrl"}}}).state("diagnoses-list",{url:"/patients/{patientId:int}/diagnoses",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/diagnoses/diagnoses-list.html",controller:"DiagnosesListCtrl"}}}).state("diagnoses-detail",{url:"/patients/{patientId:int}/diagnoses/{diagnosisIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/diagnoses/diagnoses-list.html",controller:"DiagnosesListCtrl"},detail:{templateUrl:"views/diagnoses/diagnoses-detail.html",controller:"DiagnosesDetailCtrl"}}}).state("allergies",{url:"/patients/{patientId:int}/allergies",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/allergies/allergies-list.html",controller:"AllergiesListCtrl"}}}).state("allergies-detail",{url:"/patients/{patientId:int}/allergies/{allergyIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/allergies/allergies-list.html",controller:"AllergiesListCtrl"},detail:{templateUrl:"views/allergies/allergies-detail.html",controller:"AllergiesDetailCtrl"}}}).state("medications",{url:"/patients/{patientId:int}/medications",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/medications/medications-list.html",controller:"MedicationsListCtrl"}}}).state("medications-detail",{url:"/patients/{patientId:int}/medications/{medicationIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/medications/medications-list.html",controller:"MedicationsListCtrl"},detail:{templateUrl:"views/medications/medications-detail.html",controller:"MedicationsDetailCtrl"}}}).state("contacts",{url:"/patients/{patientId:int}/contacts",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/contacts/contacts-list.html",controller:"ContactsListCtrl"}}}).state("contacts-detail",{url:"/patients/{patientId:int}/contacts/{contactIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/contacts/contacts-list.html",controller:"ContactsListCtrl"},detail:{templateUrl:"views/contacts/contacts-detail.html",controller:"ContactsDetailCtrl"}}}).state("transferOfCare",{url:"/patients/{patientId:int}/transfer-of-care-list",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/transfer-of-care/transfer-of-care-list.html",controller:"TransferOfCareListCtrl"}}}).state("transferOfCare-detail",{url:"/patients/{patientId:int}/transfer-of-care-detail/{transferOfCareIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/transfer-of-care/transfer-of-care-list.html",controller:"TransferOfCareListCtrl"},detail:{templateUrl:"views/transfer-of-care/transfer-of-care-detail.html",controller:"TransferOfCareDetailCtrl"}}}).state("transferOfCare-create",{url:"/patients/{patientId:int}/transfer-of-care-create",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{controller:"TransferOfCareCtrl"}}}).state("cancerMdt",{url:"/patients/{patientId:int}/cancer-mdt-list",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/cancer-mdt/cancermdt-list.html",controller:"CancerMdtListCtrl"}}}).state("cancerMdt-detail",{url:"/patients/{patientId:int}/cancer-mdt-detail/{cancerMdtIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/cancer-mdt/cancermdt-list.html",controller:"CancerMdtListCtrl"},detail:{templateUrl:"views/cancer-mdt/cancer-mdt-detail.html",controller:"CancerMdtDetailCtrl"}}}).state("procedures",{url:"/patients/{patientId:int}/procedures",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/procedures/procedures-list.html",controller:"ProceduresListCtrl"}}}).state("procedures-detail",{url:"/patients/{patientId:int}/procedures/{procedureIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/procedures/procedures-list.html",controller:"ProceduresListCtrl"},detail:{templateUrl:"views/procedures/procedures-detail.html",controller:"ProceduresDetailCtrl"}}}).state("referrals",{url:"/patients/{patientId:int}/referrals",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/referrals/referrals-list.html",controller:"ReferralsListCtrl"}}}).state("referrals-detail",{url:"/patients/{patientId:int}/referrals/{referralIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/referrals/referrals-list.html",controller:"ReferralsListCtrl"},detail:{templateUrl:"views/referrals/referrals-detail.html",controller:"ReferralsDetailCtrl"}}}).state("eolcareplans",{url:"/patients/{patientId:int}/eolcareplans",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/care-plans/eolcareplans-list.html",controller:"EolcareplansListCtrl"}}}).state("eolcareplans-detail",{url:"/patients/{patientId:int}/eolcareplans/{eolcareplansIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/care-plans/eolcareplans-list.html",controller:"EolcareplansListCtrl"},detail:{templateUrl:"views/care-plans/eolcareplans-detail.html",controller:"EolcareplansDetailCtrl"}}}).state("appointments",{url:"/patients/{patientId:int}/appointments",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/appointments/appointments-list.html",controller:"AppointmentsListCtrl"}}}).state("appointments-detail",{url:"/patients/{patientId:int}/appointments/{appointmentIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/appointments/appointments-list.html",controller:"AppointmentsListCtrl"},detail:{templateUrl:"views/appointments/appointments-detail.html",controller:"AppointmentsDetailCtrl"}}}).state("orders",{url:"/patients/{patientId:int}/orders",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/orders/orders-list.html",controller:"OrdersListCtrl"}}}).state("orders-detail",{url:"/patients/{patientId:int}/orders/{orderIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/orders/orders-list.html",controller:"OrdersListCtrl"},detail:{templateUrl:"views/orders/orders-detail.html",controller:"OrdersDetailCtrl"}}}).state("results",{url:"/patients/{patientId:int}/results",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/results/results-list.html",controller:"ResultsListCtrl"}}}).state("results-detail",{url:"/patients/{patientId:int}/results/{resultIndex:int}",views:{"user-context":{templateUrl:"views/patients/patients-context.html",controller:"PatientsDetailCtrl"},actions:{templateUrl:"views/patients/patients-sidebar.html",controller:"PatientsDetailCtrl"},main:{templateUrl:"views/results/results-list.html",controller:"ResultsListCtrl"},detail:{templateUrl:"views/results/results-detail.html",controller:"ResultsDetailCtrl"}}})}]).directive("datepickerPopup",function(){return{restrict:"EAC",require:"ngModel",link:function(a,b,c,d){d.$formatters.unshift()}}}).config(["datepickerConfig","datepickerPopupConfig","cfpLoadingBarProvider",function(a,b,c){a.startingDay=1,b.showButtonBar=!1,b.datepickerPopup="dd-MMM-yyyy",c.includeSpinner=!1}]).config(["paginationTemplateProvider",function(a){a.setPath("views/dirPagination.tpl.html")}]),angular.module("openehrPocApp").factory("PatientService",["$http","Patient",function(a,b){var c=function(){return a.get("/api/patients").then(function(a){var c=[];return angular.forEach(a.data,function(a){a=new b(a),c.push(a)}),c})},d=function(c){return a.get("/api/patients/"+c,{cache:!0}).then(function(a){return new b(a.data)})},e=function(b){var c={address1:b.address1,address2:b.address2,address3:b.address3,address4:b.address4,address5:b.address5,born:b.born,department:b.department,firstname:b.firstname,gPPractice:b.gPPractice,gender:b.gender,id:b.id,lastname:b.lastname,nhsNo:b.nhsNo,phone:b.phone,postCode:b.postCode,title:b.title};return a.put("/api/patients",c)},f=function(a,b){var c=_.findWhere(a.diagnoses,{id:b.id});angular.extend(c,b)},g=function(){return c().then(function(a){var b={};return b.age=_.chain(a).filter(function(a){return!!a.age}).countBy(function(a){return a.ageRange}).map(function(a,b){return{series:b,value:a}}).sortBy(function(a){return a.ageRange}).reverse().value(),b.department=_.chain(a).filter(function(a){return!!a.department}).countBy(function(a){return a.department}).map(function(a,b){return{series:b,value:a}}).sortBy(function(a){return a.department}).value(),b})},h={};h.role="",h.email="",h.isAuthenticated=!1;var i=function(a,b){h.role=a,h.email=b,a&&(h.isAuthenticated=!0)},j=function(){return h};return{all:c,get:d,update:f,summaries:g,create:e,setCurrentUser:i,getCurrentUser:j}}]),angular.module("openehrPocApp").factory("Diagnosis",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/diagnoses")},d=function(c,d){return console.log("new compositon is:"),console.log(d),console.log("new diagnosis array"),console.log(d.problems),a.post("/api/patients/"+(b||c)+"/diagnoses",d)},e=function(c,d){return console.log("new compositon is:"),console.log(d),console.log("new diagnosis array"),console.log(d.problems),a.put("/api/patients/"+(b||c)+"/diagnoses",d)};return{all:c,update:e,create:d}}]),angular.module("openehrPocApp").factory("Allergy",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/allergies")},d=function(c,d){return console.log("put allergy comp:"),console.log(d),a.put("/api/patients/"+(b||c)+"/allergies",d)};return{all:c,update:d}}]),angular.module("openehrPocApp").factory("Medication",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/medications")},d=function(c,d){return console.log("post medication comp:"),console.log(d),a.post("/api/patients/"+(b||c)+"/medications",d)},e=function(c,d){return console.log("put medication comp:"),console.log(d),a.put("/api/patients/"+(b||c)+"/medications",d)};return{all:c,update:e,create:d}}]),angular.module("openehrPocApp").factory("Contact",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/contacts")},d=function(c,d){return console.log("post composition:"),console.log(d),a.post("/api/patients/"+(b||c)+"/contacts",d)},e=function(c,d){return a.put("/api/patients/"+(b||c)+"/contacts",d)};return{all:c,update:e,create:d}}]),angular.module("openehrPocApp").factory("SmspLookup",["$http","Patient",function(a,b){var c=function(c,d){return a.post("/api/smsp-search",{firstname:c,lastname:d}).then(function(a){var c=[];return angular.forEach(a.data,function(a){a=new b(a),c.push(a)}),c})};return{byName:c}}]),angular.module("openehrPocApp").factory("TransferOfCare",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/transfer-of-care/summary")},d=function(c){return a.get("/api/patients/"+(b||c)+"/transfer-of-care/")},e=function(c,d){return console.log("transferOfCareComposition: "),console.log(d),a.post("/api/patients/"+(b||c)+"/transfer-of-care",d)},f=function(c,d){return console.log("transferOfCareComposition: "),console.log(d),a.put("/api/patients/"+(b||c)+"/transfer-of-care",d)};return{get:c,getComposition:d,create:e,update:f}}]),angular.module("openehrPocApp").factory("CancerMdt",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/mdtreports/")},d=function(c,d){return console.log("create cancerMdtComposition: "),console.log(d),a.post("/api/patients/"+(b||c)+"/mdtreports",d)},e=function(c,d){return console.log("update cancerMdtComposition: "),console.log(d),a.put("/api/patients/"+(b||c)+"/mdtreports",d)};return{getComposition:c,create:d,update:e}}]),angular.module("openehrPocApp").factory("Appointment",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/appointments")},d=function(c,d){return console.log("post appointment comp:"),console.log(d),a.post("/api/patients/"+(b||c)+"/appointments",d)},e=function(c,d){return console.log("put appointment comp:"),console.log(d),a.put("/api/patients/"+(b||c)+"/appointments",d)};return{all:c,update:e,create:d}}]),angular.module("openehrPocApp").factory("Referral",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/referrals")},d=function(c,d){return console.log("post referral comp:"),console.log(d),a.post("/api/patients/"+(b||c)+"/referrals",d)},e=function(c,d){return console.log("put referral comp:"),console.log(d),a.put("/api/patients/"+(b||c)+"/referrals",d)};return{all:c,update:e,create:d}}]),angular.module("openehrPocApp").factory("Eolcareplan",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/eolcareplans")},d=function(c,d){return console.log("post composition:"),console.log(d),a.post("/api/patients/"+(b||c)+"/eolcareplans",d)},e=function(c,d){return a.put("/api/patients/"+(b||c)+"/eolcareplans",d)};return{all:c,update:e,create:d}}]),angular.module("openehrPocApp").factory("Procedure",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/procedures")},d=function(c,d){return a.post("/api/patients/"+(b||c)+"/procedures",d)},e=function(c,d){return a.put("/api/patients/"+(b||c)+"/procedures",d)};return{all:c,update:e,create:d}}]),angular.module("openehrPocApp").factory("DateFormatter",function(){var a=function(a){return moment(a).format("YYYY-MM-DD")};return{clean:a}}),angular.module("openehrPocApp").factory("Result",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/labresults")};return{all:c}}]),angular.module("openehrPocApp").factory("Order",["$http",function(a){var b=9999999e3,c=function(c){return a.get("/api/patients/"+(b||c)+"/laborders")},d=function(c,d){return console.log("post composition:"),console.log(d),a.post("/api/patients/"+(b||c)+"/laborders",d)},e=function(c,d){return a.put("/api/patients/"+(b||c)+"/laborders",d)},f=function(b){return a.get("/api/terminology/local/list/order")};return{all:c,update:e,create:d,suggestion:f}}]),angular.module("openehrPocApp").factory("Patient",["$window",function(a){var b=function(b){var c=this;_.extend(this,b),c.fullname=function(){return c.lastname.toUpperCase()+", "+c.firstname+(c.title?" ("+c.title+")":"")},c.address=function(){return[c.address1,c.address2,c.address3,c.address4,c.address5,c.postCode].join(", ")}(),c.age=function(){return a.moment().diff(c.born,"years")},c.ageRange=function(){var a=c.age();switch(!0){case a>=0&&10>=a:return"0-10";case a>=11&&18>=a:return"11-18";case a>=19&&30>=a:return"19-30";case a>=31&&60>=a:return"31-60";case a>=60&&80>=a:return"60-80";case a>80:return">80";default:return}}()};return b}]),angular.module("openehrPocApp").controller("PatientsListCtrl",["$scope","$state","$stateParams","PatientService",function(a,b,c,d){d.all().then(function(b){a.patients=b}),a.order=c.order||"lastname",a.reverse="true"===c.reverse,a.filters={department:c.department,ageRange:c.ageRange},a.sort=function(d){var e=a.reverse;a.order===d&&(e=!e),b.transitionTo(b.current,_.extend(c,{order:d,reverse:e}))},a.sortClass=function(b){return a.order===b?a.reverse?"sort-desc":"sort-asc":void 0},a.go=function(a){b.go("patients-summary",{patientId:a.id})},a.patientFilter=function(b){return a.filters.department?b.department===a.filters.department:a.filters.ageRange?b.ageRange===a.filters.ageRange:!0}}]),angular.module("openehrPocApp").controller("headerController",["$scope","$rootScope","$state","$stateParams","PatientService",function(a,b,c,d,e){var f=d.role,g=d.email;switch(e.setCurrentUser(f,g),a.currentUser=e.getCurrentUser(),console.log(a.currentUser),a.currentUser.role||(a.currentUser.role="idcr",a.currentUser.email="example@email.com"),a.currentUser.role){case"idcr":c.go("patients-charts");break;case"phr":c.go("patients-summary",{patientId:10});break;default:c.go("patients-summary",{patientId:10})}b.$on("$stateChangeSuccess",function(b,d,e,f,g){var h="",i="",j="",k=0,l=0;switch(d.name){case"patients-list":h="patients-charts",i="Patient Lists",j="Patient Dashboard",k=12,l=0;break;case"patients-charts":h="",i="Patient Dashboard",j="",k=12,l=0;break;case"patients-summary":h="patients-list",i="Patients Summary",j="Patient Lists",k=12,l=0;break;case"patients-lookup":h="",i="",j="",k=6,l=6;break;default:h="patients-list",i="Patients Details",j="Patient Lists",k=6,l=6}a.pageHeader=i,a.previousState=h,a.previousPage=j,a.mainWidth=k,a.detailWidth=l,a.goBack=function(){c.go(h)},"user-context"in c.current.views?a.userContextViewExists=!0:a.userContextViewExists=!1,"actions"in c.current.views?a.actionsExists=!0:a.actionsExists=!1,a.go=function(a){c.go("patients-summary",{patientId:a.id})},"idcr"===a.currentUser.role&&(a.title="IDCR POC"),"phr"===a.currentUser.role&&(a.title="PHR"),a.goHome=function(){"idcr"===a.currentUser.role&&c.go("patients-charts"),"phr"===a.currentUser.role&&c.go("patients-summary",{patientId:10})}})}]),angular.module("openehrPocApp").controller("PatientsChartsCtrl",["$scope","$window","$state","PatientService","$modal","$stateParams",function(a,b,c,d,e,f){a.openModal=function(a,b){e.open({templateUrl:"views/confirmation.html",size:"md",controller:["$scope",function(d){d.cancel=function(){d.$close(!0)},d.ok=function(){switch(d.$close(!0),b){case"all":c.go("patients-list");break;case"age":c.go("patients-list",{ageRange:a.series});break;case"summary":"All"===a.series&&(a.series=null),c.go("patients-list",{department:a.series});break;default:c.go("patients-list")}}}]})};var g=function(c){b.Morris.Bar({element:"age-chart",resize:!0,data:c.age,ykeys:["value"],xkey:"series",labels:["Patients"],barColors:["#7E28CD"],ymin:0,ymax:46,barGap:4,barSizeRatio:.55,xLabelAngle:50,redraw:!0}).on("click",function(b,c){var d="age";a.openModal(c,d)})},h=function(c){b.Morris.Bar({element:"department-chart",resize:!0,data:c.department,ykeys:["value"],xkey:"series",labels:["Patients"],hideHover:!0,barColors:["#25A174"],ymin:0,ymax:40,barGap:4,barSizeRatio:.55,xLabelAngle:50,redraw:!0}).on("click",function(b,c){var d="summary";a.openModal(c,d)})};jQuery(document).ready(function(b){b(".chart-inner select").change(function(){var a=b(this).val();b(this).closest(".chart-inner").find(".chart").each(function(){b(this).attr("id")===a?b(this).show():b(this).hide()})}),a.toggleChart=function(){"age"===a.selectedChart?(b("#age-chart").empty(),b("#department-chart").empty(),b("#age-chart").off("click"),b("#department-chart").off("click"),d.summaries().then(function(a){g(a)})):(b("#age-chart").empty(),b("#department-chart").empty(),b("#age-chart").off("click"),b("#department-chart").off("click"),d.summaries().then(function(a){h(a)}))}}),a.selectedChart="age",a.toggleChart()}]),angular.module("openehrPocApp").controller("PatientsLookupCtrl",["$modal","$state",function(a,b){a.open({templateUrl:"views/patients/patients-lookup.html",size:"lg",controller:["$scope","SmspLookup","PatientService",function(a,b,c){a.search=function(c,d){a.searching=!0,b.byName(c,d).then(function(b){a.patients=b,a.searching=!1},function(){a.searching=!1})},a.create=function(b){c.create(b).then(function(){a.save()})},a.dismiss=function(){a.$dismiss()},a.save=function(){a.$close(!0)}}]}).result["finally"](function(){b.go("patients-charts")})}]),angular.module("openehrPocApp").controller("PatientsSummaryCtrl",["$scope","$stateParams","$location","PatientService","Diagnosis","Allergy","Medication","Contact","TransferOfCare",function(a,b,c,d,e,f,g,h,i){d.get(b.patientId).then(function(b){a.patient=b}),e.all(b.patientId).then(function(b){a.result=b.data,a.diagnosesCount=a.result.problems.length,a.diagnoses=a.result.problems.slice(0,5)}),f.all(b.patientId).then(function(b){a.result=b.data,a.allergiesCount=a.result.allergies.length,a.allergies=a.result.allergies.slice(0,5)}),g.all(b.patientId).then(function(b){a.result=b.data,a.medicationsCount=a.result.medications.length,a.medications=a.result.medications.slice(0,5)}),h.all(b.patientId).then(function(b){a.result=b.data,a.contactsCount=a.result.contacts.length,a.contacts=a.result.contacts.slice(0,5)}),i.getComposition(b.patientId).then(function(b){a.transferofCaresCount=b.data.transfers.length,a.transferofCareComposition=b.data;for(var c=[],d=a.transferofCareComposition.transfers.length-1;d>=0;d--)c.push(a.transferofCareComposition.transfers[d]);a.transferofCareComposition.transfers=c,console.log(a.transferofCareComposition),a.transferofCareComposition=a.transferofCareComposition.transfers.slice(0,5),console.log(a.transferofCareComposition)}),a.go=function(a){c.path(a)}}]),angular.module("openehrPocApp").controller("PatientsDetailCtrl",["$scope","$stateParams","PatientService",function(a,b,c){c.get(b.patientId).then(function(b){a.patient=b})}]),angular.module("openehrPocApp").controller("DiagnosesListCtrl",["$scope","$state","$stateParams","$location","$modal","PatientService","Diagnosis",function(a,b,c,d,e,f,g){a.search=function(b){return-1!==angular.lowercase(b.problem).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.dateOfOnset).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},f.get(c.patientId).then(function(b){a.patient=b}),g.all(c.patientId).then(function(b){a.result=b.data,a.diagnoses=a.result.problems;for(var c=0;c<a.diagnoses.length;c++)a.diagnoses[c].dateOfOnset=moment(a.diagnoses[c].dateOfOnset).format("DD-MMM-YYYY")}),a.go=function(a){d.path(a)},a.selected=function(a){return a===c.diagnosisIndex},a.create=function(){var c=e.open({templateUrl:"views/diagnoses/diagnoses-modal.html",size:"lg",controller:"DiagnosesModalCtrl",resolve:{modal:function(){return{title:"Create Problems/Diagnosis"}},diagnosis:function(){return{}},patient:function(){return a.patient}}});c.result.then(function(c){a.result.problems.push(c),g.create(a.patient.id,a.result).then(function(){b.go("diagnoses-list",{patientId:a.patient.id})})})}}]),angular.module("openehrPocApp").controller("DiagnosesDetailCtrl",["$scope","$stateParams","$location","$modal","PatientService","Diagnosis",function(a,b,c,d,e,f){a.UnlockedSources=["handi.ehrscape.com"],e.get(b.patientId).then(function(b){a.patient=b}),f.all(b.patientId).then(function(c){a.result=c.data,a.diagnosis=a.result.problems[b.diagnosisIndex],a.diagnosisSelectionNumber=b.diagnosisIndex+1}),a.formDisabled=!0,a.edit=function(){var e=d.open({templateUrl:"views/diagnoses/diagnoses-modal.html",size:"lg",controller:"DiagnosesModalCtrl",resolve:{modal:function(){return{title:"Edit Problems/Diagnosis"}},diagnosis:function(){return angular.copy(a.diagnosis)},patient:function(){return a.patient}}});e.result.then(function(d){a.result.problems[b.diagnosisIndex]=d,f.create(a.patient.id,a.result).then(function(){c.path("/patients/"+a.patient.id+"/diagnoses")})})},a.isLocked=function(b){if(!b||!b.id)return!0;var c=b.id.toString().split("::");return c.length>1?a.UnlockedSources.indexOf(c[1])<0:!0},a.convertToLabel=function(a){var b=a.replace(/([A-Z])/g," $1");return b.charAt(0).toUpperCase()+b.slice(1)}}]),angular.module("openehrPocApp").controller("DiagnosesModalCtrl",["$scope","$modalInstance","diagnosis","patient","modal",function(a,b,c,d,e){a.diagnosis=c,a.patient=d,a.modal=e,a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("openehrPocApp").controller("AllergiesListCtrl",["$scope","$location","$stateParams","$modal","$state","PatientService","Allergy",function(a,b,c,d,e,f,g){a.query={},a.queryBy="$",f.get(c.patientId).then(function(b){a.patient=b}),g.all(c.patientId).then(function(b){a.result=b.data,a.allergies=a.result.allergies}),a.go=function(a){b.path(a)},a.selected=function(a){return a===c.allergyIndex},a.create=function(){var b=d.open({templateUrl:"views/allergies/allergies-modal.html",size:"lg",controller:"AllergiesModalCtrl",resolve:{modal:function(){return{title:"Create Allergy"}},allergy:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){a.result.allergies.push(b),g.update(a.patient.id,a.result).then(function(){e.go("allergies",{patientId:a.patient.id})})})}}]),angular.module("openehrPocApp").controller("AllergiesDetailCtrl",["$scope","$stateParams","$modal","$location","PatientService","Allergy",function(a,b,c,d,e,f){e.get(b.patientId).then(function(b){a.patient=b}),f.all(b.patientId).then(function(c){a.result=c.data,a.allergy=a.result.allergies[b.allergyIndex],a.allergySelectionNumber=b.allergyIndex+1}),a.edit=function(){var e=c.open({templateUrl:"views/allergies/allergies-modal.html",size:"lg",controller:"AllergiesModalCtrl",resolve:{modal:function(){return{title:"Edit Allergy"}},allergy:function(){return angular.copy(a.allergy)},patient:function(){return a.patient}}});e.result.then(function(c){a.result.allergies[b.allergyIndex]=c,f.update(a.patient.id,a.result).then(function(){d.path("/patients/"+a.patient.id+"/allergies")})})}}]),angular.module("openehrPocApp").controller("AllergiesModalCtrl",["$scope","$modalInstance","allergy","patient","modal",function(a,b,c,d,e){a.allergy=c,a.patient=d,a.modal=e,a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("openehrPocApp").controller("MedicationsListCtrl",["$scope","$location","$stateParams","$modal","$state","PatientService","Medication",function(a,b,c,d,e,f,g){a.query={},a.queryBy="$",f.get(c.patientId).then(function(b){a.patient=b}),g.all(c.patientId).then(function(b){a.result=b.data,a.medications=a.result.medications}),a.go=function(a){b.path(a)},a.selected=function(a){return a===c.medicationIndex},a.create=function(){var b=d.open({templateUrl:"views/medications/medications-modal.html",size:"lg",controller:"MedicationsModalCtrl",resolve:{modal:function(){return{title:"Create Medication"}},medication:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){a.result.medications.push(b),g.create(a.patient.id,a.result).then(function(){e.go("medications",{patientId:a.patient.id})})})}}]),angular.module("openehrPocApp").controller("MedicationsDetailCtrl",["$scope","$stateParams","$modal","$location","PatientService","Medication",function(a,b,c,d,e,f){e.get(b.patientId).then(function(b){a.patient=b}),f.all(b.medicationIndex).then(function(c){a.result=c.data,a.medication=a.result.medications[b.medicationIndex],a.medicationSelectionNumber=b.medicationIndex+1}),a.edit=function(){var e=c.open({templateUrl:"views/medications/medications-modal.html",size:"lg",controller:"MedicationsModalCtrl",resolve:{modal:function(){return{title:"Edit Medication"}},medication:function(){return angular.copy(a.medication)},patient:function(){return a.patient}}});e.result.then(function(c){a.result.medications[b.medicationIndex]=c,f.create(a.patient.id,a.result).then(function(){d.path("/patients/"+a.patient.id+"/medications")})})}}]),angular.module("openehrPocApp").controller("MedicationsModalCtrl",["$scope","$modalInstance","medication","patient","modal",function(a,b,c,d,e){a.medication=c,a.patient=d,a.modal=e,a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel");
},a.openDatepicker=function(b,c){console.log(b),console.log(c),b.preventDefault(),b.stopPropagation(),a[c]=!0,console.log(a[c])}}]),angular.module("openehrPocApp").controller("ContactsListCtrl",["$scope","$location","$stateParams","$modal","$state","PatientService","Contact",function(a,b,c,d,e,f,g){a.query={},a.queryBy="$",f.get(c.patientId).then(function(b){a.patient=b}),g.all(c.patientId).then(function(b){a.result=b.data,a.contacts=a.result.contacts}),a.go=function(a){b.path(a)},a.selected=function(a){return a===c.contactIndex},a.create=function(){var b=d.open({templateUrl:"views/contacts/contacts-modal.html",size:"lg",controller:"ContactsModalCtrl",resolve:{modal:function(){return{title:"Create Contact"}},contact:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){a.result.contacts.push(b),g.create(a.patient.id,a.result).then(function(){e.go("contacts",{patientId:a.patient.id})})})}}]),angular.module("openehrPocApp").controller("ContactsDetailCtrl",["$scope","$stateParams","$modal","$location","PatientService","Contact",function(a,b,c,d,e,f){e.get(b.patientId).then(function(b){a.patient=b}),f.all(b.contactId).then(function(c){a.result=c.data,a.contact=a.result.contacts[b.contactIndex],a.contactSelectionNumber=b.contactIndex+1}),a.edit=function(){var e=c.open({templateUrl:"views/contacts/contacts-modal.html",size:"lg",controller:"ContactsModalCtrl",resolve:{modal:function(){return{title:"Edit Contact"}},contact:function(){return angular.copy(a.contact)},patient:function(){return a.patient}}});e.result.then(function(c){a.result.contacts[b.contactIndex]=c,f.create(a.patient.id,a.result).then(function(){d.path("/patients/"+a.patient.id+"/contacts")})})}}]),angular.module("openehrPocApp").controller("ContactsModalCtrl",["$scope","$modalInstance","contact","patient","modal",function(a,b,c,d,e){a.contact=c,a.patient=d,a.modal=e,a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("openehrPocApp").controller("TransferOfCareCtrl",["$modal","$state","$scope","$stateParams","PatientService","TransferOfCare",function(a,b,c,d,e,f){function g(){a.open({templateUrl:"views/transfer-of-care/transfer-of-care-confirmation.html",size:"md",controller:["$scope",function(a){a.ok=function(){a.$close()}}]}).result["finally"](function(){b.go("transferOfCare",{patientId:c.patient.id})})}a.open({templateUrl:"views/transfer-of-care/transfer-of-care-modal.html",size:"lg",resolve:{patient:function(){return e.get(d.patientId).then(function(a){return c.patient=a,c.patient})},transferOfCare:function(){return f.get(d.patientId).then(function(a){return c.transferOfCare=a.data,c.transferOfCare})},transferOfCareCompositions:function(){return f.getComposition(d.patientId).then(function(a){return c.transferOfCareCompositions=a.data,c.transferOfCareCompositions})}},controller:["$scope","patient","transferOfCare","transferOfCareCompositions",function(a,c,d,e){function g(){var b=jQuery.extend(!0,{},a.transferOfCare.allergies,a.transferOfCare.contacts,a.transferOfCare.medication,a.transferOfCare.problems);delete b.compositionId;for(var c in a.selectedItems)switch(c){case"allergies":case"contacts":case"medications":case"problems":for(var d=b[c].length;d--;){var e=!1;angular.forEach(a.selectedItems[c],function(a){var b=a;d===b&&(e=!0)}),e===!1&&b[c].splice(d,1)}}return b}a.patient=c,a.transferOfCare=d,a.allergies=a.transferOfCare.allergies.allergies,a.contacts=a.transferOfCare.contacts.contacts,a.problems=a.transferOfCare.problems.problems,a.medications=a.transferOfCare.medication.medications,a.transferOfCareComposition=e,a.siteFrom=a.transferOfCareComposition.transfers[0].transferDetail.site.siteFrom,a.selectedItems={allergies:[],contacts:[],medications:[],problems:[]},a.transferDetail={site:{}},a.selectTransferOfCareItem=function(b,c){-1!==a.selectedItems[c].indexOf(b)?a.selectedItems[c].splice(a.selectedItems[c].indexOf(b),1):a.selectedItems[c].push(b)},a.isItemSelected=function(b,c){return-1!==a.selectedItems[c].indexOf(b)?"transfer-of-care-green":"transfer-of-care-red"},a.isItemSelectedIcon=function(b,c){return-1!==a.selectedItems[c].indexOf(b)?"glyphicon glyphicon-ok":"glyphicon glyphicon-remove"},a.getSelectedItItemsForSummary=function(b){a.formSubmitted=!0,b.$valid&&(a.selectedItemsForSummary=g(),a.selectedAllergies=a.selectedItemsForSummary.allergies,a.selectedContacts=a.selectedItemsForSummary.contacts,a.selectedProblems=a.selectedItemsForSummary.problems,a.selectedMedications=a.selectedItemsForSummary.medications,a.transferDetail.reasonForContact=a.details.reasonForContact?a.details.reasonForContact:"No reason specified",a.transferDetail.clinicalSummary=a.details.clinicalSummary?a.details.clinicalSummary:"No clinical summary",a.transferDetail.site.siteFrom=a.siteFrom?a.siteFrom:"No site from",a.transferDetail.site.siteTo=a.details.siteTo?a.details.siteTo:"No site to",a.transferDetail.site.patientId=9999999e3,a.toggleDetailView())},a.displayDetail=!1,a.toggleDetailView=function(){a.displayDetail=!a.displayDetail},a.dismiss=function(){a.$dismiss(),b.go("transferOfCare",{patientId:a.patient.id})},a.ok=function(){a.transferOfCare=g(),a.transferOfCare.medication=a.transferOfCare.medications,delete a.transferOfCare.medications,a.transferOfCare.transferDetail=a.transferDetail,a.transferOfCareComposition.transfers.push(a.transferOfCare),console.log(a.transferOfCareComposition),f.create(a.patient.id,a.transferOfCareComposition).then(function(){a.$close()}),a.$close()}}]}).result.then(function(){g()})}]),angular.module("openehrPocApp").controller("TransferOfCareListCtrl",["$scope","$location","$stateParams","$modal","$state","PatientService","TransferOfCare",function(a,b,c,d,e,f,g){a.query={},a.queryBy="$",f.get(c.patientId).then(function(b){a.patient=b}),g.getComposition(c.patientId).then(function(b){a.transferofCareComposition=b.data}),a.go=function(a){b.path(a)},a.selected=function(a){return console.log(c),a===c.transferOfCareIndex},a.create=function(){e.go("transferOfCare-create",{patientId:a.patient.id})}}]),angular.module("openehrPocApp").controller("TransferOfCareDetailCtrl",["$scope","$stateParams","$modal","$location","PatientService","TransferOfCare",function(a,b,c,d,e,f){e.get(b.patientId).then(function(b){a.patient=b}),f.getComposition(b.patientId).then(function(c){a.transferofCareComposition=c.data,a.transferOfCare=a.transferofCareComposition.transfers[b.transferOfCareIndex],a.transferOfCareSelectionNumber=b.transferOfCareIndex+1,a.allergies=a.transferOfCare.allergies,a.contacts=a.transferOfCare.contacts,a.problems=a.transferOfCare.problems,a.medications=a.transferOfCare.medication,a.transferDetail=a.transferOfCare.transferDetail,a.site=a.transferOfCare.transferDetail.site})}]),angular.module("openehrPocApp").controller("CancerMdtModalCtrl",["$scope","$modalInstance","$stateParams","$state","cancerMdt","patient","modal",function(a,b,c,d,e,f,g){a.cancerMdt=e,a.protocol="http://","Edit MDT"===g.title&&(a.cancerMdt.timeOfMeeting=new Date(a.cancerMdt.timeOfMeeting)),a.changeProtocol=function(b){switch(b){case"http":a.protocol="http://";break;case"https":a.protocol="https://";break;default:a.protocol="http://"}},a.patient=f,a.modal=g,a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.dateofMeetingDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.validate=function(a,b,c){var d=b+c;for(var e in a.$error.required){var f=a.$error.required[e].$name;if(f===d)return!0}},a.validateDirty=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$invalid?!0:!1},a.validateClean=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$valid?!0:!1}}]),angular.module("openehrPocApp").controller("CancerMdtListCtrl",["$scope","$location","$stateParams","$modal","$state","PatientService","CancerMdt",function(a,b,c,d,e,f,g){a.search=function(b){return-1!==angular.lowercase(b.dateOfRequest).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.service).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.dateOfMeeting).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},f.get(c.patientId).then(function(b){a.patient=b}),g.getComposition(c.patientId).then(function(b){a.cancerMdtComposition=b.data;for(var c=0;c<a.cancerMdtComposition.length;c++)a.cancerMdtComposition[c].dateOfRequest=moment(a.cancerMdtComposition[c].dateOfRequest).format("DD-MMM-YYYY"),a.cancerMdtComposition[c].dateOfMeeting=moment(a.cancerMdtComposition[c].dateOfMeeting).format("DD-MMM-YYYY")}),a.go=function(a){b.path(a)},a.selected=function(a){return a===c.cancerMdtIndex},a.create=function(){var b=d.open({templateUrl:"views/cancer-mdt/cancer-mdt-modal.html",size:"lg",controller:"CancerMdtModalCtrl",resolve:{modal:function(){return{title:"Create MDT"}},cancerMdt:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){b.dateOfMeeting=new Date(b.dateOfMeeting),b.dateOfRequest=new Date(b.dateOfRequest),null!==b.timeOfMeeting&&(b.timeOfMeeting=new Date(b.timeOfMeeting),b.timeOfMeeting.setMinutes(b.timeOfMeeting.getMinutes()-b.timeOfMeeting.getTimezoneOffset())),b.compositionId="",b.source="openehr",g.create(a.patient.id,b).then(function(){e.go("cancerMdt",{patientId:a.patient.id})})})}}]),angular.module("openehrPocApp").controller("CancerMdtDetailCtrl",["$scope","$stateParams","$modal","$location","$state","PatientService","CancerMdt",function(a,b,c,d,e,f,g){f.get(b.patientId).then(function(b){a.patient=b}),g.getComposition(b.patientId).then(function(c){a.cancerMdtComposition=c.data,a.cancerMdt=a.cancerMdtComposition[b.cancerMdtIndex]}),a.edit=function(){var b=c.open({templateUrl:"views/cancer-mdt/cancer-mdt-modal.html",size:"lg",controller:"CancerMdtModalCtrl",resolve:{modal:function(){return{title:"Edit MDT"}},cancerMdt:function(){return angular.copy(a.cancerMdt)},patient:function(){return a.patient}}});b.result.then(function(b){b.dateOfMeeting=new Date(b.dateOfMeeting),b.dateOfRequest=new Date(b.dateOfRequest),null!==b.timeOfMeeting&&(b.timeOfMeeting=new Date(b.timeOfMeeting)),g.update(a.patient.id,b).then(function(){e.go("cancerMdt",{patientId:a.patient.id})})})}}]),angular.module("openehrPocApp").controller("AppointmentsModalCtrl",["$scope","$modalInstance","$modal","appointment","patient","modal","PatientService",function(a,b,c,d,e,f,g){function h(b){var d=c.open({templateUrl:"views/appointments/appointments-confirm-modal.html",size:"sm   ",windowClass:"confirm-modal",controller:"AppointmentsConfirmModalCtrl",resolve:{modal:function(){return{title:"Confirm Date"}},time:function(){return angular.copy(b)}}});d.result.then(function(c){a.appointment.timeSlot=b,a.appointment.status="Scheduled",a.appointment.dateOfAppointment=b.toISOString().slice(0,10),a.timeSlotFull=moment(a.appointment.timeSlot).format("h:mma")+"-"+moment(a.appointment.timeSlot).add(59,"m").format("h:mma"),i(),a.radioModel="Tab1"})}function i(){for(var b=a.appointment.dateOfAppointment.slice(0,10)+" "+a.appointment.timeSlot.toISOString().slice(11,13)+":00",c=0;c<a.uiConfig.calendar.events.length;c++){var d=a.uiConfig.calendar.events[c];"#6599C8"===d.color&&(d.color="#378006"),d.start===b&&(d.color="#6599C8")}}a.currentUser=g.getCurrentUser(),a.appointment=d,a.patient=e,a.modal=f,a.radioModel="Tab1",a.appointment.location=d.location||"Leeds General",a.appointment.status=d.status||"Not Scheduled","Scheduled"===a.appointment.status&&(a.timeSlotFull=moment(d.timeSlot).format("h:mma")+"-"+moment(d.timeSlot).add(59,"m").format("h:mma")),a.uiConfig={calendar:{height:450,width:400,editable:!0,aspectRatio:1.7,defaultDate:"2015-02-12",Duration:"01:00:00",lang:"en-gb",eventColor:"#378006",events:[{title:"Time Slot 1",start:"2015-02-09 09:00",end:"2015-02-09 09:59"},{title:"Time Slot 2",start:"2015-02-09 10:00",end:"2015-02-09 10:59"},{title:"Time Slot 3",start:"2015-02-09 11:00",end:"2015-02-09 11:59"},{title:"Time Slot 4",start:"2015-02-09 12:00",end:"2015-02-09 12:59"},{title:"Time Slot 5",start:"2015-02-09 13:00",end:"2015-02-09 13:59"},{title:"Time Slot 6",start:"2015-02-09 14:00",end:"2015-02-09 14:59"},{title:"Time Slot 7",start:"2015-02-09 15:00",end:"2015-02-09 15:59"},{title:"Time Slot 8",start:"2015-02-09 16:00",end:"2015-02-09 16:59"},{title:"Time Slot 1",start:"2015-02-10 09:00",end:"2015-02-10 09:59"},{title:"Time Slot 2",start:"2015-02-10 10:00",end:"2015-02-10 10:59"},{title:"Time Slot 3",start:"2015-02-10 11:00",end:"2015-02-10 11:59"},{title:"Time Slot 4",start:"2015-02-10 12:00",end:"2015-02-10 12:59"},{title:"Time Slot 5",start:"2015-02-10 13:00",end:"2015-02-10 13:59"},{title:"Time Slot 6",start:"2015-02-10 14:00",end:"2015-02-10 14:59"},{title:"Time Slot 7",start:"2015-02-10 15:00",end:"2015-02-10 15:59"},{title:"Time Slot 8",start:"2015-02-10 16:00",end:"2015-02-10 16:59"},{title:"Time Slot 1",start:"2015-02-11 09:00",end:"2015-02-11 09:59"},{title:"Time Slot 2",start:"2015-02-11 10:00",end:"2015-02-11 10:59"},{title:"Time Slot 3",start:"2015-02-11 11:00",end:"2015-02-11 11:59"},{title:"Time Slot 4",start:"2015-02-11 12:00",end:"2015-02-11 12:59"},{title:"Time Slot 5",start:"2015-02-11 13:00",end:"2015-02-11 13:59"},{title:"Time Slot 6",start:"2015-02-11 14:00",end:"2015-02-11 14:59"},{title:"Time Slot 7",start:"2015-02-11 15:00",end:"2015-02-11 15:59"},{title:"Time Slot 8",start:"2015-02-11 16:00",end:"2015-02-11 16:59"},{title:"Time Slot 1",start:"2015-02-12 09:00",end:"2015-02-12 09:59"},{title:"Time Slot 2",start:"2015-02-12 10:00",end:"2015-02-12 10:59"},{title:"Time Slot 3",start:"2015-02-12 11:00",end:"2015-02-12 11:59"},{title:"Time Slot 4",start:"2015-02-12 12:00",end:"2015-02-12 12:59"},{title:"Time Slot 5",start:"2015-02-12 13:00",end:"2015-02-12 13:59"},{title:"Time Slot 6",start:"2015-02-12 14:00",end:"2015-02-12 14:59"},{title:"Time Slot 7",start:"2015-02-12 15:00",end:"2015-02-12 15:59"},{title:"Time Slot 8",start:"2015-02-12 16:00",end:"2015-02-12 16:59"},{title:"Time Slot 1",start:"2015-02-13 09:00",end:"2015-02-13 09:59"},{title:"Time Slot 2",start:"2015-02-13 10:00",end:"2015-02-13 10:59"},{title:"Time Slot 3",start:"2015-02-13 11:00",end:"2015-02-13 11:59"},{title:"Time Slot 4",start:"2015-02-13 12:00",end:"2015-02-13 12:59"},{title:"Time Slot 5",start:"2015-02-13 13:00",end:"2015-02-13 13:59",color:"#dd2b08"},{title:"Time Slot 6",start:"2015-02-13 14:00",end:"2015-02-13 14:59"},{title:"Time Slot 7",start:"2015-02-13 15:00",end:"2015-02-13 15:59"},{title:"Time Slot 8",start:"2015-02-13 16:00",end:"2015-02-13 16:59"}],header:{right:"month,agendaWeek,agendaDay",center:"title",left:"prev,next"},columnFormat:{week:"ddd D/M"},eventClick:function(b,c,d){a.setTimeSlot(b.start)},eventMouseover:function(a,b,c){"#dd2b08"===a.color&&$(this).css("cursor","not-allowed")},eventDrop:a.alertOnDrop,eventResize:a.alertOnResize,defaultView:"agendaWeek",allDaySlot:!1,minTime:"9:00",maxTime:"17:00",weekends:!1}},a.eventSources=[],"Create Appointment"===f.title?a.appointment.dateCreated=(new Date).toISOString().slice(0,10):(a.appointment.timeSlot=new Date(a.appointment.timeSlot),i());var j=function(){return a.appointment.dateOfAppointment&&a.appointment.timeSlot};a.getScheduleLabel=function(){return j()?" Re-Schedule":" Schedule"},a.openAppointmentDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.setTimeSlot=function(b){for(var c=0;c<a.uiConfig.calendar.events.length;c++){var d=a.uiConfig.calendar.events[c];d.start===b._i&&("#dd2b08"===d.color||h(b))}},a.schedule=function(){a.radioModel="Tab2"},a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("openehrPocApp").controller("AppointmentsConfirmModalCtrl",["$scope","$modalInstance","time",function(a,b,c){a.modal=b,a.time=new Date(c),a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("openehrPocApp").controller("AppointmentsListCtrl",["$scope","$location","$stateParams","$modal","$state","PatientService","Appointment",function(a,b,c,d,e,f,g){a.search=function(b){return-1!==angular.lowercase(b.dateOfAppointment).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.timeSlot).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.careServiceTeam).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},f.get(c.patientId).then(function(b){a.patient=b}),g.all(c.patientId).then(function(b){a.appointments=b.data;for(var c=0;c<a.appointments.length;c++)a.appointments[c].dateOfAppointment=moment(a.appointments[c].dateOfAppointment).format("DD-MMM-YYYY"),a.appointments[c].timeSlot=moment(a.appointments[c].timeSlot).format("HH:mm")}),a.go=function(c){b.path("/patients/"+a.patient.id+"/appointments/"+c)},a.selected=function(a){return a===c.appointmentIndex},a.create=function(){var b=d.open({templateUrl:"views/appointments/appointments-modal.html",size:"lg",controller:"AppointmentsModalCtrl",resolve:{modal:function(){return{title:"Create Appointment"}},appointment:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){b.dateOfAppointment=new Date(b.dateOfAppointment),b.date=new Date(b.date);var c={compositionId:"",careServiceTeam:b.careServiceTeam,dateOfAppointment:b.dateOfAppointment,location:b.location,status:b.status,author:b.author,dateCreated:b.date,source:"openehr",timeSlot:b.timeSlot};g.create(a.patient.id,c).then(function(){e.go("appointments",{patientId:a.patient.id})})})}}]),angular.module("openehrPocApp").controller("AppointmentsDetailCtrl",["$scope","$stateParams","$modal","$location","PatientService","Appointment",function(a,b,c,d,e,f){e.get(b.patientId).then(function(b){a.patient=b}),f.all(b.appointmentIndex).then(function(c){a.appointment=c.data[b.appointmentIndex]}),a.edit=function(){var b=c.open({templateUrl:"views/appointments/appointments-modal.html",size:"lg",controller:"AppointmentsModalCtrl",resolve:{modal:function(){return{title:"Edit Appointment"}},appointment:function(){return angular.copy(a.appointment)},patient:function(){return a.patient}}});b.result.then(function(b){b.dateOfAppointment=new Date(b.dateOfAppointment),b.date=new Date(b.date);var c={compositionId:a.appointment.compositionId,careServiceTeam:b.careServiceTeam,dateOfAppointment:b.dateOfAppointment,location:b.location,status:b.status,author:b.author,dateCreated:b.date,source:"openehr",timeSlot:b.timeSlot};f.update(a.patient.id,c).then(function(){d.path("/patients/"+a.patient.id+"/appointments")})})}}]),angular.module("openehrPocApp").controller("ReferralsModalCtrl",["$scope","$modalInstance","referral","PatientService","patient","modal",function(a,b,c,d,e,f){a.currentUser=d.getCurrentUser(),a.referral=c,a.patient=e,a.modal=f,"Create Referral"===f.title&&(a.referral.dateCreated=(new Date).toISOString().slice(0,10),a.author=a.currentUser),a.referralCreatedDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.dateofReferralDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]),angular.module("openehrPocApp").controller("ReferralsListCtrl",["$scope","$location","$stateParams","$modal","$state","PatientService","Referral",function(a,b,c,d,e,f,g){a.search=function(b){return-1!==angular.lowercase(b.dateOfReferral).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.referralFrom).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.referralTo).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},f.get(c.patientId).then(function(b){a.patient=b}),g.all(c.patientId).then(function(b){if(a.result=b.data,b.data.length>0){a.referrals=a.result;for(var c=0;c<a.referrals.length;c++)a.referrals[c].dateOfReferral=moment(a.referrals[c].dateOfReferral).format("DD-MMM-YYYY")}}),a.go=function(a){b.path(a)},a.selected=function(a){return a===c.referralIndex},a.create=function(){var b=d.open({templateUrl:"views/referrals/referrals-modal.html",size:"lg",controller:"ReferralsModalCtrl",resolve:{modal:function(){return{title:"Create Referral"}},referral:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){var c={compositionId:"",author:b.author,clinicalSummary:b.clinicalSummary,dateCreated:new Date(b.dateCreated),dateOfReferral:b.dateOfReferral,reasonForReferral:b.reasonForReferral,referralFrom:b.referralFrom,referralTo:b.referralTo,source:"openehr"};g.create(a.patient.id,c).then(function(){e.go("referrals",{patientId:a.patient.id})})})}}]),angular.module("openehrPocApp").controller("ReferralsDetailCtrl",["$scope","$stateParams","$modal","$location","PatientService","Referral",function(a,b,c,d,e,f){e.get(b.patientId).then(function(b){a.patient=b}),f.all(b.referralId).then(function(c){a.result=c.data,a.referral=a.result[b.referralIndex]}),a.edit=function(){var b=c.open({templateUrl:"views/referrals/referrals-modal.html",size:"lg",controller:"ReferralsModalCtrl",resolve:{modal:function(){return{title:"Edit Referral"}},referral:function(){return angular.copy(a.referral)},patient:function(){return a.patient}}});b.result.then(function(b){var c={compositionId:a.referral.compositionId,author:b.author,clinicalSummary:b.clinicalSummary,dateCreated:b.dateCreated,dateOfReferral:b.dateOfReferral,reasonForReferral:b.reasonForReferral,referralFrom:b.referralFrom,referralTo:b.referralTo,source:"openehr"};f.update(a.patient.id,c).then(function(){d.path("/patients/"+a.patient.id+"/referrals")})})}}]),angular.module("openehrPocApp").controller("EolcareplansModalCtrl",["$scope","$filter","$modalInstance","eolcareplan","patient","modal","PatientService",function(a,b,c,d,e,f,g){if(a.currentUser=g.getCurrentUser(),a.eolcareplan=d,a.patient=e,a.modal=f,a.docTypes=[{type:"Document Type"},{type:"Document Type 2"}],"Create End of Life Care Document"===f.title){var h=(new Date).toISOString().slice(0,10);a.eolcareplan.careDocument={date:h}}a.ok=function(b,d){a.formSubmitted=!0,b.$valid&&c.close(d)},a.cancel=function(){c.dismiss("cancel")},a.radioModel="Tab1",a.typesAvaliable=["Document","Document T1","Document T2","Document T3"],a.typesChosen=a.typesAvaliable[0],a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.openDecisionDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.dateofcprdecisionDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.validate=function(a,b,c){var d=b+c;for(var e in a.$error.required){var f=a.$error.required[e].$name;if(f===d)return!0}},a.validateDirty=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$invalid?!0:!1},a.validateClean=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$valid?!0:!1}}]),angular.module("openehrPocApp").controller("EolcareplansListCtrl",["$scope","$location","$stateParams","$modal","$state","PatientService","Eolcareplan",function(a,b,c,d,e,f,g){a.search=function(b){return-1!==angular.lowercase(b.careDocument.name).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.careDocument.type).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.careDocument.date).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},f.get(c.patientId).then(function(b){a.patient=b}),g.all(c.patientId).then(function(b){if(a.result=b.data,b.data.length>0){a.eolcareplans=a.result;for(var c=0;c<a.eolcareplans.length;c++)a.eolcareplans[c].careDocument.date=moment(a.eolcareplans[c].careDocument.date).format("DD-MMM-YYYY")}}),a.go=function(c){b.path("/patients/"+a.patient.id+"/eolcareplans/"+c)},a.selected=function(a){return a===c.eolcareplansIndex},a.create=function(){var b=d.open({templateUrl:"views/care-plans/eolcareplans-modal.html",size:"lg",controller:"EolcareplansModalCtrl",resolve:{modal:function(){return{title:"Create End of Life Care Document"}},eolcareplan:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){b.careDocument.date=new Date(b.careDocument.date),b.careDocument.type=b.careDocument.type.type;var c={compositionId:"",careDocument:b.careDocument,cprDecision:b.cprDecision,prioritiesOfCare:b.prioritiesOfCare,source:"openehr",treatmentDecision:b.treatmentDecision};g.create(a.patient.id,c).then(function(){e.go("eolcareplans",{patientId:a.patient.id})})})}}]),angular.module("openehrPocApp").controller("EolcareplansDetailCtrl",["$scope","$stateParams","$modal","$location","PatientService","Eolcareplan","DateFormatter",function(a,b,c,d,e,f,g){e.get(b.patientId).then(function(b){a.patient=b}),f.all(b.eolcareplanId).then(function(c){a.result=c.data,a.eolcareplan=a.result[b.eolcareplansIndex]}),a.edit=function(){var b=c.open({templateUrl:"views/care-plans/eolcareplans-modal.html",size:"lg",controller:"EolcareplansModalCtrl",resolve:{modal:function(){return{title:"Edit End of Life Care Document"}},eolcareplan:function(){return angular.copy(a.eolcareplan)},patient:function(){return a.patient}}});b.result.then(function(b){b.careDocument.type=b.careDocument.type.type;var c={compositionId:b.compositionId,careDocument:b.careDocument,cprDecision:b.cprDecision,prioritiesOfCare:b.prioritiesOfCare,source:"openehr",treatmentDecision:b.treatmentDecision};f.update(a.patient.id,c).then(function(){d.path("/patients/"+a.patient.id+"/eolcareplans")})})}}]),angular.module("openehrPocApp").controller("ProceduresModalCtrl",["$scope","$filter","$modalInstance","PatientService","patient","modal","procedure",function(a,b,c,d,e,f,g){a.currentUser=d.getCurrentUser(),a.procedure=g,a.patient=e,a.modal=f,"Create Procedure"===f.title&&(a.procedure.dateSubmitted=(new Date).toISOString().slice(0,10)),a.procedure.code="1234567",a.procedure.terminology="ICD-10",a.procedure.timeOfProcedure=moment(a.procedure.timeOfProcedure),a.dateofProcedureDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.dateofSubmittedDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0},a.ok=function(b,d){a.formSubmitted=!0,b.$valid&&c.close(d)},a.cancel=function(){c.dismiss("cancel")},a.validate=function(a,b,c){var d=b+c;for(var e in a.$error.required){var f=a.$error.required[e].$name;if(f===d)return!0}},a.validateDirty=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$invalid?!0:!1},a.validateClean=function(a,b,c){var d=b+c;return a[d].$dirty&&a[d].$valid?!0:!1}}]),angular.module("openehrPocApp").controller("ProceduresListCtrl",["$scope","$location","$stateParams","$modal","$state","PatientService","Procedure",function(a,b,c,d,e,f,g){a.search=function(b){return-1!==angular.lowercase(b.procedureName).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.dateOfProcedure).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.timeOfProcedure).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},f.get(c.patientId).then(function(b){a.patient=b}),g.all(c.patientId).then(function(b){a.procedures=b.data;for(var c=0;c<a.procedures.length;c++)a.procedures[c].dateOfProcedure=moment(a.procedures[c].dateOfProcedure).format("DD-MMM-YYYY"),a.procedures[c].timeOfProcedure=moment(a.procedures[c].timeOfProcedure).format("HH:mm")}),a.go=function(a){b.path(a)},a.selected=function(a){return a===c.procedureIndex},a.create=function(){var b=d.open({templateUrl:"views/procedures/procedures-modal.html",size:"lg",controller:"ProceduresModalCtrl",resolve:{modal:function(){return{title:"Create Procedure"}},procedure:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){b.dateSubmitted=new Date(b.dateSubmitted),b.dateOfProcedure=new Date(b.dateOfProcedure),b.timeOfProcedure=new Date(b.timeOfProcedure.valueOf()-6e4*b.timeOfProcedure.getTimezoneOffset());var c={compositionId:"",procedureName:b.procedureName,procedureNotes:b.procedureNotes,author:b.author,terminology:"local",code:"at0047",dateOfProcedure:b.dateOfProcedure,timeOfProcedure:b.timeOfProcedure,performer:b.performer,dateSubmitted:b.dateSubmitted,source:"openehr"};g.create(a.patient.id,c).then(function(){e.go("procedures",{patientId:a.patient.id})})})}}]),angular.module("openehrPocApp").controller("ProceduresDetailCtrl",["$scope","$stateParams","$modal","$location","PatientService","Procedure","DateFormatter",function(a,b,c,d,e,f,g){e.get(b.patientId).then(function(b){a.patient=b}),f.all(b.procedureId).then(function(c){a.result=c.data,a.procedure=a.result[b.procedureIndex]}),a.edit=function(){var b=c.open({templateUrl:"views/procedures/procedures-modal.html",size:"lg",controller:"ProceduresModalCtrl",resolve:{modal:function(){return{title:"Edit Procedure"}},procedure:function(){return angular.copy(a.procedure)},patient:function(){return a.patient}}});b.result.then(function(b){b.dateSubmitted=new Date(b.dateSubmitted),b.dateOfProcedure=new Date(b.dateOfProcedure);var c={compositionId:a.procedure.compositionId,procedureName:b.procedureName,procedureNotes:b.procedureNotes,author:b.author,terminology:"local",code:"at0047",dateOfProcedure:b.dateOfProcedure,timeOfProcedure:b.timeOfProcedure,performer:b.performer,dateSubmitted:b.dateSubmitted,source:"openehr"};f.update(a.patient.id,c).then(function(){d.path("/patients/"+a.patient.id+"/procedures")})})}}]),angular.module("openehrPocApp").controller("ResultsListCtrl",["$scope","$location","$stateParams","$modal","$state","PatientService","Result",function(a,b,c,d,e,f,g){a.search=function(b){return-1!==angular.lowercase(b.name).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.sampleTaken).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.dateReported).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},f.get(c.patientId).then(function(b){a.patient=b}),g.all(c.patientId).then(function(b){a.results=b.data;for(var c=0;c<a.results.length;c++)a.results[c].sampleTaken=moment(a.results[c].sampleTaken).format("DD-MMM-YYYY"),a.results[c].dateReported=moment(a.results[c].dateReported).format("DD-MMM-YYYY")}),a.go=function(a){b.path(a)},a.selected=function(a){return a===c.resultIndex}}]),angular.module("openehrPocApp").controller("ResultsDetailCtrl",["$scope","$stateParams","$modal","$location","PatientService","Result",function(a,b,c,d,e,f){e.get(b.patientId).then(function(b){a.patient=b}),f.all(b.resultIndex).then(function(c){a.result=c.data[b.resultIndex]})}]),angular.module("openehrPocApp").controller("OrdersListCtrl",["$scope","$location","$stateParams","$modal","$state","PatientService","Order",function(a,b,c,d,e,f,g){a.search=function(b){return-1!==angular.lowercase(b.name).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.date).indexOf(angular.lowercase(a.query)||"")||-1!==angular.lowercase(b.source).indexOf(angular.lowercase(a.query)||"")},f.get(c.patientId).then(function(b){a.patient=b}),g.all(c.patientId).then(function(b){a.orders=b.data;for(var c=0;c<a.orders.length;c++)a.orders[c].date=moment(a.orders[c].date).format("DD-MMM-YYYY")}),a.go=function(a){b.path(a)},a.selected=function(a){return a===c.orderIndex},a.create=function(){var b=d.open({templateUrl:"views/orders/orders-modal.html",size:"lg",controller:"OrdersModalCtrl",resolve:{modal:function(){return{title:"Create Order"}},order:function(){return{}},patient:function(){return a.patient}}});b.result.then(function(b){b.compositionId="",b.date=new Date(b.date),g.create(a.patient.id,b).then(function(){e.go("orders",{
patientId:a.patient.id})})})}}]),angular.module("openehrPocApp").controller("OrdersDetailCtrl",["$scope","$stateParams","$modal","$location","PatientService","Order",function(a,b,c,d,e,f){e.get(b.patientId).then(function(b){a.patient=b}),f.all(b.resultIndex).then(function(c){a.result=c.data,a.order=a.result[b.orderIndex]}),a.edit=function(){var b=c.open({templateUrl:"views/orders/orders-modal.html",size:"lg",controller:"OrdersModalCtrl",resolve:{modal:function(){return{title:"Edit Order"}},order:function(){return angular.copy(a.order)},patient:function(){return a.patient}}});b.result.then(function(b){f.update(a.patient.id,b).then(function(){d.path("/patients/"+a.patient.id+"/orders")})})}}]),angular.module("openehrPocApp").controller("OrdersModalCtrl",["$scope","$modalInstance","order","patient","modal","Order","PatientService",function(a,b,c,d,e,f,g){a.currentUser=g.getCurrentUser(),a.order=c,a.patient=d,a.modal=e,a.order.author=a.currentUser.email,"Create Order"===e.title&&(a.order.date=(new Date).toISOString().slice(0,10)),f.suggestion().then(function(b){a.suggestions=b.data}),a.ok=function(c,d){a.formSubmitted=!0,c.$valid&&b.close(d)},a.cancel=function(){b.dismiss("cancel")},a.openDatepicker=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]);